- name: Installing P
    apt: name={{ item }} update_cache=true state=installed
    with_items:
     - postgresql
     - libpq-dev
     - python-psycopg2
     - postgresql-contrib
    tags: packages
  
  - name: Creaci贸n de base de datos en PostgreSQL
    become: yes
    become_user: postgres
    vars:
      ansible_ssh_pipelining: true
    postgresql_db:
      name: drupal
      encoding: UTF-8
  
  - name: Creaci贸n de usuario en la base de datos de PostgreSQL y dar privilegios al usuario creado
    become: yes
    become_user: postgres
    vars:
      ansible_ssh_pipelining: true
      postgresql_user:
      db: drupal
      name: drupal
      password: drupal
      priv: "ALL"
      expires: infinity

  - name: Copiar fichero de configuraci贸n /etc/postgresql/9.6/main/postgresql.conf
    copy: >
      src=files/postgresql/etc/postgresql/9.6/main/postgresql.conf
      dest=/etc/postgresql/9.6/main/postgresql.conf
      owner=postgres
      group=postgres

  - name: Copiar fichero de configuraci贸n /etc/postgresql/9.6/main/pg_hba.conf
    copy: >
      src=files/postgresql/etc/postgresql/9.6/main/pg_hba.conf
      dest=/etc/postgresql/9.6/main/pg_hba.conf
      owner=postgres
      group=postgres

    notify:
     - Reiniciar SGBD PostgreSQL

    handlers:
     - name: Reiniciar SGBD PostgreSQL
         service:
         name: postgresql state: restarted
